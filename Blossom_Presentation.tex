\documentclass[aspectratio=169, 11pt]{beamer}

% --- LANGUAGE SETTINGS ---
\usepackage[english]{babel}
% ------------------------------------------------

\usepackage{tikz}
\usepackage{xcolor}
\usepackage{amsmath}
\usepackage{booktabs}

% ====================================================================
% SAKURA THEME COLOR DEFINITIONS
% ====================================================================
\definecolor{sakurabg}{HTML}{FFF0F5}    % Lavender Blush (Soft background)
\definecolor{sakurapink}{HTML}{FFB7C5}  % Cherry Blossom Pink
\definecolor{sakuradeep}{HTML}{E87A90}  % Deeper Japanese Sakura Pink
\definecolor{sakuradark}{HTML}{4A252D}  % Deep maroon/brown for text
\definecolor{sakurabranch}{HTML}{3D2314} % Branch brown

% ====================================================================
% BEAMER COLOR & FONT SETTINGS
% ====================================================================
\setbeamercolor{normal text}{fg=sakuradark, bg=sakurabg}
\setbeamercolor{structure}{fg=sakuradeep}
\setbeamercolor{background canvas}{bg=sakurabg}

\setbeamercolor{title}{fg=sakuradark, bg=sakurapink!40!white}
\setbeamercolor{frametitle}{fg=sakuradark, bg=sakurapink!30!white}

% Block Colors
\setbeamercolor{block title}{bg=sakuradeep, fg=white}
\setbeamercolor{block body}{bg=sakurapink!20!white, fg=sakuradark}

\setbeamercolor{block title alerted}{bg=sakuradark, fg=white}
\setbeamercolor{block body alerted}{bg=sakuradark!10!white, fg=sakuradark}

\setbeamercolor{block title example}{bg=sakurapink!80!sakuradark, fg=white}
\setbeamercolor{block body example}{bg=sakurapink!15!white, fg=sakuradark}

% Fonts & Layout
\setbeamerfont{title}{size=\Huge, series=\bfseries}
\setbeamerfont{frametitle}{size=\LARGE, series=\bfseries}
\setbeamerfont{block title}{series=\bfseries}
\setbeamertemplate{blocks}[rounded][shadow=true]
\setbeamertemplate{navigation symbols}{} % Remove standard navigation icons
\setbeamercolor{footline}{fg=sakuradark, bg=sakurapink!20!white}

% Slide numbers (bottom-right)
\setbeamertemplate{footline}{
\leavevmode%
\hbox{%
\begin{beamercolorbox}[wd=\paperwidth,ht=2.6ex,dp=1.2ex,rightskip=0.5cm]{footline}%
\usebeamerfont{footline}\insertframenumber{} / \inserttotalframenumber
\end{beamercolorbox}%
}%
}

% ====================================================================
% TIKZ MACROS FOR CHERRY BLOSSOMS
% ====================================================================

% Macro to draw a 5-petal Sakura flower
% Arguments: #1=X pos, #2=Y pos, #3=Scale, #4=Rotation
\newcommand{\sakuraflower}[4]{
	\begin{scope}[shift={(#1,#2)}, scale=#3, rotate=#4]
		% Draw 5 petals using mathematical bezier curves to create a cleft
		\foreach \a in {0,72,...,288} {
			\fill[sakuradeep, opacity=0.85] 
			(0,0) .. controls (\a+30:0.8) and (\a+20:1.2) .. 
			(\a+8:1.05) .. controls (\a+2:0.95) and (\a-2:0.95) .. 
			(\a-8:1.05) .. controls (\a-20:1.2) and (\a-30:0.8) .. (0,0);
		}
		% Flower center/stigma
		\fill[sakurapink!40!white] (0,0) circle (0.15);
		\foreach \a in {0,72,...,288} {
			\draw[sakuradark, line width=0.4pt] (0,0) -- (\a:0.25);
			\fill[sakuradark] (\a:0.25) circle (0.02);
		}
	\end{scope}
}

% Macro to draw a single falling petal
\newcommand{\fallingpetal}[4]{
	\begin{scope}[shift={(#1,#2)}, scale=#3, rotate=#4]
		\fill[sakuradeep, opacity=0.7] 
		(0,0) .. controls (30:0.8) and (20:1.2) .. 
		(8:1.05) .. controls (2:0.95) and (-2:0.95) .. 
		(-8:1.05) .. controls (-20:1.2) and (-30:0.8) .. (0,0);
	\end{scope}
}

% ====================================================================
% BEAMER TEMPLATE OVERRIDES
% ====================================================================

% 1. Global Background Template
\setbeamertemplate{background}{
	\begin{tikzpicture}[remember picture, overlay, shift={(current page.south west)}]
		% Solid background color
		\fill[sakurabg] (0,0) rectangle (\paperwidth, \paperheight);
		
		% Render scattered petals only on regular content pages
		\ifnum\thepage>1\relax
		\sakuraflower{15.0}{1.0}{0.4}{15}
		\sakuraflower{15.5}{1.8}{0.25}{45}
		\fallingpetal{14.0}{1.5}{0.3}{-20}
		\fallingpetal{1.0}{8.0}{0.3}{110}
		\fallingpetal{2.0}{8.5}{0.2}{80}
		\fi
	\end{tikzpicture}
}

% 2. Title Page Template
\setbeamertemplate{title page}{
	\begin{tikzpicture}[remember picture, overlay, shift={(current page.south west)}]
		% --- Branches ---
		\draw[sakurabranch, line width=4pt] (16, 9) .. controls (14, 7) and (13, 8) .. (11, 5);
		\draw[sakurabranch, line width=2pt] (13.5, 7.5) .. controls (12, 6) and (12, 5) .. (11.5, 4.5);
		
		% --- Branch Flowers ---
		\sakuraflower{14.5}{7.8}{0.7}{10}
		\sakuraflower{13.0}{6.5}{0.9}{-15}
		\sakuraflower{11.5}{5.0}{0.6}{45}
		\sakuraflower{12.2}{5.8}{0.5}{120}
		\sakuraflower{11.0}{4.2}{0.4}{30}
		
		% --- Scattered / Falling Petals ---
		\fallingpetal{10.0}{7.0}{0.4}{-30}
		\fallingpetal{8.0}{5.0}{0.5}{-45}
		\fallingpetal{9.0}{2.0}{0.3}{-10}
		\fallingpetal{12.0}{3.0}{0.4}{15}
		\fallingpetal{6.0}{8.0}{0.4}{-60}
		\fallingpetal{4.0}{6.0}{0.5}{-80}
		\fallingpetal{2.0}{4.0}{0.3}{-40}
		\fallingpetal{3.0}{1.0}{0.6}{-20}
		\fallingpetal{1.0}{2.0}{0.4}{10}
		\fallingpetal{14.0}{1.0}{0.5}{25}
		
		% --- Title Content ---
		\node[anchor=center, align=center, text width=12cm] at (8, 4.5) {
			\begin{beamercolorbox}[sep=12pt,center,rounded=true,shadow=true]{title}
				\usebeamerfont{title}\inserttitle\par
				\ifx\insertsubtitle\@empty\else
				\vskip0.5em
				{\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}
				\fi
			\end{beamercolorbox}
			\vskip1.5em
			{\usebeamerfont{author}\usebeamercolor[fg]{normal text}\insertauthor\par}
			\vskip0.5em
			{\usebeamerfont{institute}\usebeamercolor[fg]{normal text}\insertinstitute\par}
			\vskip0.5em
			{\usebeamerfont{date}\usebeamercolor[fg]{normal text}\insertdate\par}
		};
	\end{tikzpicture}
}

% 3. Frametitle Template
\setbeamertemplate{frametitle}{
	\nointerlineskip
	\vspace*{0.2cm}
	\begin{beamercolorbox}[wd=\paperwidth,ht=1.2cm,dp=0.4cm,leftskip=0.5cm,rightskip=0.5cm, rounded=true]{frametitle}
		\usebeamerfont{frametitle}\insertframetitle
		\hfill
		\raisebox{-0.2cm}{\begin{tikzpicture}\sakuraflower{0}{0}{0.3}{15}\end{tikzpicture}}
	\end{beamercolorbox}
}

% 4. Itemize Bullets Template
\setbeamertemplate{itemize item}{\raisebox{-0.3ex}{\begin{tikzpicture}\sakuraflower{0}{0}{0.12}{0}\end{tikzpicture}}}
\setbeamertemplate{itemize subitem}{\raisebox{-0.3ex}{\begin{tikzpicture}\fallingpetal{0}{0}{0.12}{45}\end{tikzpicture}}}
\setbeamertemplate{itemize subsubitem}{\raisebox{-0.3ex}{\begin{tikzpicture}\fallingpetal{0}{0}{0.08}{45}\end{tikzpicture}}}

% ====================================================================
% DOCUMENT INFORMATION
% ====================================================================
\title{Cherry Blossom Peak Bloom Prediction}
\subtitle{Methodology and 2026 Results (LM vs LASSO)}
\author{Callie Ann Pokorski\\ Daul-MS Operations Research and Statistical Science}
\institute{George Mason University}
\date{\today}

\begin{document}
	
	% --- Title Slide ---
	\begin{frame}[plain]
		\titlepage
	\end{frame}
	
	% --- Slide 1 ---
	\begin{frame}{Objective and Scope}
		\begin{itemize}
			\item Predict 2026 peak bloom day-of-year for Kyoto, Washington DC, Liestal, Vancouver, and New York City.
			\item Compare two models built on the same pre-bloom climate features:
			\begin{itemize}
				\item Linear regression (LM)
				\item LASSO (CV-selected $\lambda_{\min}$)
			\end{itemize}
			\item Report uncertainty as $\pm$ days for both models.
		\end{itemize}
		
		\begin{block}{Data window}
			All workflows are restricted to years $\geq 1973$.
		\end{block}
	\end{frame}
	
	% --- Slide 2 ---
	\begin{frame}{Data Pipeline and Feature Engineering}
		\begin{itemize}
			\item Merge bloom-history and climate-station data by mapped location/station pairs.
			\item Keep core climate variables: $T_{\max}$, $T_{\min}$, precipitation.
			\item Fill short internal temperature gaps only ($<3$ consecutive days).
			\item Build yearly pre-bloom aggregates up to observed bloom date:
			\begin{itemize}
				\item mean adjusted max temperature
				\item mean adjusted min temperature
				\item total precipitation
			\end{itemize}
		\end{itemize}
	\end{frame}
	
	% --- Slide 3 ---
	\begin{frame}{Altitude Adjustment Methodology}
		\begin{block}{Rationale}
			Stations and bloom sites differ in elevation, introducing temperature bias if uncorrected.
		\end{block}
		
		\begin{equation*}
			\Delta T = 6.5\,^{\circ}\text{C}/\text{km} \cdot \frac{h_{\text{station}}-h_{\text{bloom}}}{1000}
		\end{equation*}
		\begin{equation*}
			T^{\text{adj}}_{\max}=T_{\max}+\Delta T, \qquad T^{\text{adj}}_{\min}=T_{\min}+\Delta T
		\end{equation*}
		
		\begin{itemize}
			\item If station is higher than bloom site, adjusted temperatures increase.
			\item If station is lower, adjusted temperatures decrease.
		\end{itemize}
	\end{frame}
	
	% --- Slide 4 ---
	\begin{frame}{Model Design and Split Strategy}
		\begin{columns}
			\begin{column}{0.52\textwidth}
				\begin{block}{Training / Holdout}
					\begin{itemize}
						\item Train locations: Kyoto, Washington DC, Liestal
						\item Holdout locations: Vancouver, New York City
						\item Holdout split by time:
						\begin{itemize}
							\item earlier half $\rightarrow$ validation
							\item later half $\rightarrow$ test
						\end{itemize}
					\end{itemize}
				\end{block}
			\end{column}
			\begin{column}{0.46\textwidth}
				\begin{exampleblock}{Models}
					LM and LASSO use:
					\begin{itemize}
						\item mean\_tmax\_adj\_prebloom
						\item total\_prcp\_prebloom
					\end{itemize}
				\end{exampleblock}
			\end{column}
		\end{columns}
	\end{frame}
	
	% --- Slide 5 ---
	\begin{frame}{Uncertainty Methodology}
		\begin{block}{Linear Model}
			90\% confidence bounds from regression prediction intervals.
		\end{block}
		
		\begin{block}{LASSO}
			Bootstrap-based 90\% intervals:
			\begin{enumerate}
				\item Resample training rows (with replacement)
				\item Refit LASSO at fixed $\lambda_{\min}$
				\item Predict 2026 DOY per location
				\item Use empirical 5th/95th quantiles
			\end{enumerate}
		\end{block}
	\end{frame}
	
	% --- Slide 6 ---
	\begin{frame}{Validation/Test Model Metrics}
		\small
		\begin{tabular}{lccc}
		\toprule
		Model & Split & MAE (days) & RMSE (days) \\
		\midrule
		Linear & Validation ($n=24$) & 6.62 & 8.06 \\
		Linear & Test ($n=15$) & 7.59 & 9.45 \\
		LASSO & Validation ($n=24$) & 6.62 & 8.05 \\
		LASSO & Test ($n=15$) & 7.59 & 9.45 \\
		\bottomrule
		\end{tabular}
		
		\vspace{0.6em}
		\begin{exampleblock}{Interpretation}
			LM and LASSO perform nearly identically under the reduced predictor set.
		\end{exampleblock}
	\end{frame}
	
	% --- Slide 7 ---
	\begin{frame}{Parameter Estimates (90\% CI)}
		\small
		\begin{tabular}{lccc}
		\toprule
		Model & Term & Estimate & 90\% CI \\
		\midrule
		LM & Intercept & 106.59 & [100.40, 112.78] \\
		LM & mean\_tmax\_adj\_prebloom & -1.87 & [-2.48, -1.26] \\
		LM & total\_prcp\_prebloom & 0.031 & [0.017, 0.045] \\
		LASSO & Intercept & 106.54 & [100.45, 113.22] \\
		LASSO & mean\_tmax\_adj\_prebloom & -1.86 & [-2.53, -1.23] \\
		LASSO & total\_prcp\_prebloom & 0.031 & [0.015, 0.047] \\
		\bottomrule
		\end{tabular}
		
		\vspace{0.5em}
		\begin{block}{Source}
			Exported from \texttt{data/model\_outputs/model\_parameter\_estimates\_90ci\_comparison.csv}.
		\end{block}
	\end{frame}
	
	% --- Slide 8 ---
	\begin{frame}{2026 Results: LM vs LASSO}
		\small
		For the model-date comparison, we report the predicted bloom date (in YYYY-MM-DD) and the $\pm$ uncertainty width (in days) (90\% confidence) for each location and model. The difference is calculated as (LASSO date - LM date) in terms of day-of-year (DOY).
		\begin{center}
		\begin{tabular}{lcccc}
		\toprule
		Location & LM Date & LM $\pm$ & LASSO Date & LASSO $\pm$ \\
		\midrule
		Kyoto & 2026-03-29 & 3.39 & 2026-03-29 & 3.00 \\
		Washington DC & 2026-04-02 & 1.55 & 2026-04-02 & 1.57 \\
		Liestal & 2026-04-04 & 1.54 & 2026-04-04 & 1.58 \\
		Vancouver & 2026-04-10 & 1.85 & 2026-04-10 & 1.99 \\
		New York City & 2026-04-09 & 1.58 & 2026-04-09 & 1.78 \\
		\bottomrule
		\end{tabular}
		\end{center}
		
		\vspace{0.5em}
		\begin{alertblock}{Difference (LASSO - LM, DOY)}
			Kyoto: +0.05, DC: +0.02, Liestal: +0.01, Vancouver: -0.03, NYC: -0.02
		\end{alertblock}
	\end{frame}
	
	% --- Slide 9 ---
	\begin{frame}{Takeaways}
		\begin{itemize}
			\item Reduced-feature LM and LASSO produce nearly identical validation/test performance.
			\item Parameter estimates are stable across LM and LASSO with consistent sign and magnitude.
			\item 2026 predictions are highly aligned across models (all DOY differences within about 0.05 days).
			\item Final submission can choose a single model or ensemble based on validation/test metrics.
		\end{itemize}
	\end{frame}
	
	% --- Slide 10 ---
	\begin{frame}[plain]
		\begin{tikzpicture}[remember picture, overlay, shift={(current page.center)}]
			% A massive subtle flower in the background
			\begin{scope}[opacity=0.15]
				\sakuraflower{0}{0}{5}{20}
			\end{scope}
			
			% Thank You Text
			\node[align=center] at (0, 0) {
				\Huge \textbf{\textcolor{sakuradark}{Thank You}} \\[1em]
				\Large \textcolor{sakuradeep}{Any Questions?}
			};
		\end{tikzpicture}
	\end{frame}
	
\end{document}